# Flutterアプリ「BLE Status」発表資料案

## 1. はじめに

- **アプリケーション名:** BLE Status
- **コンセプト:** **「あらゆるBLEデバイスを追跡し、専用デバイスで真価を発揮する」**
- **目的:**
    - **汎用性:** イヤホン等の手持ちのBLEデバイスを、接続状況や距離感で管理し、置き忘れを防ぐ。
    - **高機能性:** 専用コンパニオンデバイス**「AreraNaiTag」**と連携し、バッテリー残量など、よりリッチな情報を取得して紛失を未然に防ぐ。

---

## 2. システム構成

アプリは汎用デバイスと専用デバイスの両方に対応し、それぞれの利点を活かした追跡が可能です。

```mermaid
graph TD
    subgraph "基本機能 (全BLEデバイス対応)"
        A[BLE Status] -- RSSIで距離感を推定 --> B((汎用デバイス<br>イヤホン, etc.));
    end

    subgraph "拡張機能 (専用デバイス連携)"
        A -- 詳細情報 (バッテリー等) --> C(<b>AreraNaiTag</b><br>推奨コンパニオンデバイス);
    end

    subgraph "アプリのコア機能"
        A1[複数デバイスの一元管理];
        A2[状態の可視化];
        A3[デバイス情報の永続化];
    end
    A --- A1 & A2 & A3;
```

---

## 3. アプリケーションの機能

### 機能の二段階構成

| 機能レベル | 対象デバイス | 主な機能 | アピールポイント |
|---|---|---|---|
| **基本機能** | **全てのBLEデバイス** | ・RSSIに基づく接続状態と距離感の表示<br>・デバイスの登録・管理<br>・接続中デバイスの現在位置表示<br>・デバイス切断時の位置情報記録<br>・切断デバイスの最終位置表示<br>・デバイス削除時の位置情報削除 | **手軽さ:** 追加コストなしで、手持ちのデバイスをすぐに追跡開始できる。<br>**安心感:** デバイスの置き忘れや紛失時に、最終確認位置を地図で確認できる。 |
| **拡張機能** | **専用デバイス<br>「AreraNaiTag」** | ・リアルタイムでのバッテリー容量表示 | **高信頼性:** アプリと完全に連携設計されており、より正確で詳細な情報を得られる。 |

---

## 4. 画面遷移図

本アプリケーションは、ユーザーが直感的に操作できるよう、主要な機能を3つの画面に集約し、必要に応じて外部の地図アプリケーションと連携します。

### 画面構成と役割

1.  **メイン画面 (登録デバイス一覧)**:
    *   **役割**: 登録済みデバイスの接続状態を管理し、新規登録や最終位置確認を行うホーム画面です。

2.  **ペアリング画面 (デバイススキャン)**:
    *   **役割**: 新しいBluetoothデバイスをスキャンし、アプリに登録する画面です。

3.  **詳細画面 (状態監視)**:
    *   **役割**: 選択したデバイスの詳細情報表示、現在位置確認、デバイス切断を行う画面です。

4.  **地図表示 (外部アプリケーション)**:
    *   **役割**: 外部地図アプリを起動し、スマートフォン現在位置またはデバイス最終切断位置を表示する画面です。

### 画面遷移フロー

```mermaid
graph TD
    Main[メイン画面<br>(登録デバイス一覧)]
    Paring[ペアリング画面<br>(デバイススキャン)]
    Connect[詳細画面<br>(状態監視)]
    Map[地図表示<br>(外部地図アプリ)]

    Main -- 新規登録ボタンタップ --> Paring
    Paring -- デバイス選択・接続成功 --> Main
    Paring -- スキャン停止・戻るボタンタップ --> Main

    Main -- デバイスリスト項目タップ --> Connect
    Connect -- 戻るボタンタップ --> Main
    Connect -- 切断ボタンタップ --> Main

    Connect -- 「現在位置を表示」ボタンタップ --> Map
    Main -- 「最終位置を表示」ボタンタップ (切断デバイス) --> Map
    Map -- 外部アプリを閉じる --> Connect
    Map -- 外部アプリを閉じる --> Main
```

---

## 5. 技術的ハイライト

本アプリケーションの「汎用性」と「高機能性」を両立させる、2つのコア技術です。

1.  **RSSIによる汎用トラッキング技術**
    - `flutter_blue_plus` を活用し、デバイスの**RSSI（受信信号強度）**を共通指標として利用。
    - これにより、GATTサービスの仕様に依存しない、**あらゆるBLEデバイスとの基本的な連携**を可能にしました。

2.  **GATT Notifyによる高度なデバイス連携**
    - **AreraNaiTag**が持つ独自のGATTサービスと通信。
    - キャラクタリスティックの**Notify機能**を活用し、バッテリー電圧の変化などをデバイスからリアルタイムで受信。
    - アプリの汎用性を保ちつつ、特定デバイスとの連携を深める**拡張性の高いアーキテクチャ**を実現しました。

3.  **Flutterによる効率的なクロスプラットフォーム開発**
    - 単一コードベースでiOS/Androidに対応し、迅速な開発と一貫したユーザー体験を提供します。

4.  **位置情報サービス連携と地図アプリ連携**
    - `geolocator`パッケージによる高精度な位置情報取得と、`url_launcher`パッケージによる外部地図アプリケーションとのシームレスな連携を実現。デバイスの最終位置を直感的に確認できます。

---

## 6. (Appendix) AreraNaiTag 連携仕様

- **ターゲットサービス: `FeatherTagService`**
  - **UUID:** `8f2c7e40-9f2f-4dcb-bd79-bc0f2a06d3a1`

- **利用キャラクタリスティック**
| 名称 | UUID | プロパティ | 利用方法 |
|---|---|---|---|
| **Battery Voltage** | `8f2c7e43-9f2f-4dcb-bd79-bc0f2a06d3a1` | `READ`, `NOTIFY` | **READ:** 接続時に電圧を一度取得。<br>**NOTIFY:** 電圧変化の通知を購読し、UIをリアルタイム更新。 |

---

## 7. プレゼンテーション作成に向けて

- **LLMへの指示例（例）:**
  - `「この資料案を基に、『汎用トラッカーアプリと、その真価を引き出す専用デバイス』という二段構えのコンセプトで、技術発表会用のパワーポイントを10枚で作成してください。特に、汎用性と専用デバイスによる拡張性の両立が技術的な強みであることを強調してください。」`
  - `「この資料のコンセプトと機能を基に、ハードウェア（AreraNaiTag）とソフトウェア（アプリ）をセットで販売するための、投資家向けピッチ資料（3枚）を作成してください。」`